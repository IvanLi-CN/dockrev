services:
  dockrev:
    image: dockrev:local
    build:
      context: ..
      dockerfile: Dockerfile
      args:
        APP_EFFECTIVE_VERSION: "0.0.0-local"
    ports:
      - "50883:50883"
    environment:
      DOCKREV_HTTP_ADDR: "0.0.0.0:50883"
      DOCKREV_DB_PATH: "/data/dockrev.sqlite3"
      DOCKREV_DOCKER_CONFIG: "/data/docker-config.json"
      DOCKREV_COMPOSE_BIN: "docker-compose"
      DOCKREV_AUTH_ALLOW_ANONYMOUS_IN_DEV: "false"
      # DOCKREV_WEBHOOK_SECRET: "change-me"
      # DOCKREV_HOST_PLATFORM: "linux/amd64"
      # Option B (docker-socket-proxy):
      # DOCKER_HOST: "tcp://docker-socket-proxy:2375"
    volumes:
      - ./data:/data
      - /var/run/docker.sock:/var/run/docker.sock
      # Auto-discovery reads compose file paths from Compose labels (container-visible absolute paths).
      # If your compose files live on the host at /srv/compose/**, mount them read-only at the same path:
      # - /srv/compose:/srv/compose:ro
